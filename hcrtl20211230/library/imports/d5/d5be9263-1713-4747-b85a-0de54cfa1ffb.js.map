{"version":3,"sources":["assets\\script\\gameScence\\GameScence.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport LevelData from \"../data/LevelData\";\nimport TowerLayer from \"./TowerLayer\";\nimport { FirebaseReport, FirebaseKey } from \"../util/FirebaseReport\";\nimport UserData, { localStorageKey, userData } from \"../data/UserData\";\nimport Utils from \"../util/Utils\";\nimport RoleBase from \"./RoleBase\";\nimport SkinShopItemData from \"../util/SkinShopItemData\";\nimport SpineManager from \"../manager/SpineManager\";\nimport SdkManager from \"../util/SdkManager\";\n\nconst {ccclass, property} = cc._decorator;\n/**\n * 游戏场景\n */\n@ccclass\nexport default class GameScence extends cc.Component {\n\n    //默认塔楼栋数\n    private defaultTowerCount = 2;\n    //当前塔楼可移动数\n    private moveCount = 0;\n    //当前塔楼可移动步数\n    private moveStep = 0;\n    @property(TowerLayer)\n    towerLayer : TowerLayer = null;//塔楼层\n    @property(cc.Node)\n    stageArrowNode : cc.Node = null;//移动箭头\n    private level : cc.Node = null;//关卡层\n    private next : cc.Node = null;//移到下一栋\n    private prev : cc.Node = null;//移到上一栋\n    @property([cc.Prefab])\n    bg_prefabs : cc.Prefab[] = [];//背景\n    @property(cc.Label)\n    levelLabel : cc.Label = null;//关卡显示\n\n    @property(cc.Node)\n    wildRage:cc.Node = null;\n\n    @property(cc.Node)\n    btn_wildRage:cc.Node = null\n\n    @property(sp.Skeleton)\n    roleModel_victory:sp.Skeleton = null;\n\n    @property(sp.Skeleton)\n    roleModel_fail:sp.Skeleton = null;\n\n    private loading = false;\n    public static Instance : GameScence = null;\n    /**战力提升百分比 */\n    private rateOfIncreasePower:number;\n\n    private initHp:number;\n\n    private decoration:cc.Node;\n\n    private static _instance:GameScence = null;\n\n    onLoad(){\n        GameScence._instance = this;\n        this.decoration = this.wildRage.getChildByName(\"img_decoration_1\");\n        this.restartGame();\n        this.initRoleModeOfResult();\n    }\n\n\n    restartGame(){\n        if(this.loading){\n            return ;\n        }\n        this.loading = true;\n        this.towerLayer.node.removeAllChildren();\n        this.stageArrowNode.active = false;\n        this.moveStep = 0;\n        this.moveCount = 0;\n        this.init();\n    }\n\n    init(){\n        \n        LevelData.getLevel();\n        // console.log(\"======all level: \",LevelData.levelData);\n        //  LevelData.curLevel = 41;\n        //超出最大关卡，显示最后一关\n        if(LevelData.curLevel >LevelData.levelData.length){\n            LevelData.curLevel = LevelData.levelData.length;\n        }\n        let levelCount = LevelData.curLevel;\n        this.updateWildRage(levelCount);\n        this.levelLabel.string = \"Level \"+levelCount;//显示关卡数\n        switch(levelCount) {\n            case 1:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_1);\n                 break;\n            case 2:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_2);\n                 break;\n            case 3:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_3);\n                 break;\n            case 4:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_4);\n                 break;\n            case 5:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_5);\n                 break;\n            case 10:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_10);\n                 break;\n            case 15:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_15);\n                 break;\n            case 20:\n                 FirebaseReport.reportInformation(FirebaseKey.level_jinru_20);\n                 break;\n            default:\n                 break;\n        }\n        GameScence.Instance = this;\n        //获取关卡数据\n        let level = LevelData.levelData[levelCount-1];\n        let towerData = level.towerData;//关卡塔楼数据\n        this.level = this.node.getChildByName(\"level\");\n        let bg  = cc.instantiate(this.bg_prefabs[level.bg]);\n        bg.position =  new cc.Vec3(-597.097, 0, 0);\n        //增加背景\n        this.level.getChildByName(\"bg\").addChild(bg,1);\n        this.level.setScale(0.5);\n        this.towerLayer.node.x = -400;\n        this.levelScale();\n        //初始化塔楼数据\n        this.towerLayer.init(towerData);\n        let size = this.towerLayer.getSize();\n        this.moveCount = size - this.defaultTowerCount;\n        if(this.moveCount>0){//是否可移动塔楼面板\n            this.stageArrowNode.active = true;\n            this.next = this.stageArrowNode.getChildByName(\"stage_arrow_next\");\n            this.next.active = true;\n            this.prev = this.stageArrowNode.getChildByName(\"stage_arrow_prev\");\n            this.next.on(cc.Node.EventType.TOUCH_END, this.stageArrowNext, this);\n            this.prev.on(cc.Node.EventType.TOUCH_END, this.stageArrowPrev, this);\n        }\n    }\n    /**先一步加载成功和失败界面的spine动画，避免玩家看到闪烁的画面 */\n    private initRoleModeOfResult():void {\n        let usingIndex = userData.getData(localStorageKey.USING_SKIN_INDEX);\n        let skinDatas = userData.getData(localStorageKey.SHOP_DATAS) as SkinShopItemData[];\n        let resName = skinDatas[usingIndex].resName;\n        SpineManager.getInstance().loadSpine(this.roleModel_victory,\"spine/player/\"+resName, true, \"default\", \"shengli\");\n        SpineManager.getInstance().loadSpine(this.roleModel_fail,\"spine/player/\"+resName, true, \"default\", \"siwang\");\n    }\n\n    private updateWildRage(level:number):void {\n        if (level%3 != 0) {\n            this.btn_wildRage.active = false;\n            this.wildRage.active = false;\n        }\n        else {//每三关出现一次\n            let rand = Math.random();\n            let value = 0.1;//百分之十\n            if (rand < 0.4) {\n                value = 0.1;\n            }\n            else if (rand < 0.7) {\n                value = 0.15;\n            }\n            else {\n                value = 0.2;\n            }\n            this.rateOfIncreasePower = value;\n            let levelData = LevelData.levelData[level-1];\n            let towerData = levelData.towerData as any;//关卡塔楼数据\n            this.initHp = towerData[0].data[0][0].hp;\n            this.showWildRage();\n        }\n        \n    }\n    /**展示战力提升弹窗 */\n    private showWildRage():void {\n        this.btn_wildRage.active = true;\n        this.wildRage.active = true;\n        let num_power = this.decoration.getChildByName(\"num_increasePower\").getComponent(cc.Label);\n        num_power.string = \"+\" + Math.floor(this.rateOfIncreasePower * this.initHp);\n        this.decoration.y = 70;\n        this.changeDecorationPos();\n    }\n\n    private changeDecorationPos():void {\n        cc.Tween.stopAllByTarget(this.decoration);\n        cc.tween(this.decoration)\n        .to(0.5, {y:90})\n        .to(0.5, {y:70})\n        .call(()=> {\n            this.changeDecorationPos();\n        })\n        .start();\n    }\n\n    private onBtnWildRageClick():void {\n        this.showWildRage();\n    }\n\n    private onBtnNoThanksOfWildRageClick():void {\n        this.wildRage.active = false;\n    }\n\n    private onBtnObtainClick():void {\n        if (cc.sys.platform == cc.sys.ANDROID) {\n            FirebaseReport.reportInformation(FirebaseKey.zhandou_ad2_shuxing);\n            jsb.reflection.callStaticMethod(\"org/cocos2dx/javascript/RewardedAdManager\", \"JsCall_showAdIfAvailable\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\",'cc[\"GameScence\"].JavaCall_addPlayerHp()', 'cc[\"GameScence\"].JavaCall_noAdCallback()', \"zhandou_ad2_shuxing\", \"\");\n        }\n        else {\n             this.addPlayerHp();\n        }\n        //SdkManager.GetInstance().JavaRewardedAds(\"zhandou_ad2_shuxing\", () => { this.addPlayerHp(); }, () => { this.noAdCallback(); })        \n    }\n\n    /** */\n    public static JavaCall_addPlayerHp():void {\n        GameScence._instance.addPlayerHp();\n    }\n    /** */\n    private addPlayerHp():void {\n        this.wildRage.active = false;\n        this.towerLayer.addPlayerHp(Math.floor(this.rateOfIncreasePower * this.initHp));\n    }\n\n    private onBtnHomeClick():void {\n        FirebaseReport.reportInformation(FirebaseKey.zhandou_shouye);\n        cc.director.loadScene(\"MainScene\");\n    }\n\n    /**\n     * 下一关\n     */\n    public onBtnSkipLevel(){\n        if (cc.sys.platform == cc.sys.ANDROID) {\n            FirebaseReport.reportInformation(FirebaseKey.zhandou_ad2_skip);\n            jsb.reflection.callStaticMethod(\"org/cocos2dx/javascript/RewardedAdManager\", \"JsCall_showAdIfAvailable\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\",'cc[\"GameScence\"].JavaCall_skipLevel()', 'cc[\"GameScence\"].JavaCall_noAdCallback()', \"zhandou_ad2_skip\", \"\");\n        }\n        else {\n             this.skipLevel();\n        }\n\n        //SdkManager.GetInstance().JavaRewardedAds(\"zhandou_ad2_skip\", () => { this.skipLevel(); }, () => { this.noAdCallback(); })    \n        \n    }\n\n    public static JavaCall_skipLevel():void {\n        GameScence._instance.skipLevel();\n    }\n\n    private skipLevel():void {\n        if(this.loading){\n            return ;\n        }\n        LevelData.curLevel++;\n        LevelData.saveLevel();\n        this.restartGame();\n    }\n\n    /**\n     * 重玩\n     */\n    public onBtnRestartClick():void{\n        if(this.loading){\n            return ;\n        }\n        FirebaseReport.reportInformation(FirebaseKey.zhandou_playagain);\n        // cc.director.loadScene( 'GameScene');\n        this.restartGame();\n    }\n \n    /**\n     * 刷新可移动塔楼数\n     */\n    public flushMoveCount(){\n        let size = this.towerLayer.getSize();\n        this.moveCount = size - this.defaultTowerCount;\n        if(size <=2){\n            if(this.next){\n                this.next.active = false;\n            }\n           if(this.prev){\n            this.prev.active = false;\n           }\n        }\n    }\n\n    /**\n     * 下一栋塔楼\n     */\n    private stageArrowNext(){\n       \n        if(this.moveCount > this.moveStep){\n            cc.tween(this.towerLayer.node).by(0.1, { position: cc.v3(-this.towerLayer.getTowerOffsetX(), 0, 0) }).start(); //, { easing: 'sineOutIn'}\n            this.moveStep++;\n        }\n        if(this.moveCount  == this.moveStep){\n            this.next.active = false;\n            this.prev.active = true;\n        }else{\n            this.next.active = true;\n            this.prev.active = true; \n        }\n    }\n\n    //上一栋塔楼\n    private stageArrowPrev(){\n        if(this.moveStep>0){\n            cc.tween(this.towerLayer.node).by(0.1, {position: cc.v3(this.towerLayer.getTowerOffsetX(), 0, 0)}).start();\n            this.moveStep--;\n        }\n        if(this.moveStep==0){\n            this.next.active = true;\n            this.prev.active = false;\n        }else{\n            this.next.active = true;\n            this.prev.active = true;\n        }\n    }\n\n    /**\n     * 放大到初始大小\n     */\n    private levelScale(){\n        cc.tween(this.node).delay(0.5).call(()=>{\n            cc.tween(this.level).to(0.3, {scale: 1}).start();\n            cc.tween(this.towerLayer.node).to(0.3, {position: cc.v3(this.towerLayer.node.x+400,this.towerLayer.node.y,0)}).call(()=>{\n                this.loading = false;\n            }).start();\n        }).start(); \n   \n    }\n\n\n    public static JavaCall_noAdCallback():void{\n        GameScence._instance.noAdCallback();\n    }\n\n    private noAdCallback():void{\n        Utils.showMessage(this.node, \"Ad not ready\");\n       /* this.InitAdView();*/\n    }\n   \n    // update (dt) {}\n\n    //public InitAdView() {\n    //    var self = this;\n    //    cc.loader.loadRes(\"prefabs/popup/AndroidAdView\", cc.Prefab, (e, p) => {\n    //        var pnode = cc.instantiate(p as cc.Prefab);\n    //        self.node.addChild(pnode, 90);\n    //    });\n    //}\n}\n"]}