{"version":3,"sources":["assets\\script\\util\\SkinShopItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport { localStorageKey, userData } from \"../data/UserData\";\r\nimport SpineManager from \"../manager/SpineManager\";\r\nimport EventDefine from \"./EventDefine\";\r\nimport ItemRenderer from \"./ItemRenderer\";\r\nimport SkinShopItemData from \"./SkinShopItemData\";\r\nimport Utils from \"./Utils\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SkinShopItem extends ItemRenderer{\r\n    @property(cc.Node)\r\n    bed: cc.Node = null;\r\n\r\n    @property(sp.Skeleton)\r\n    model: sp.Skeleton = null;\r\n\r\n    @property(cc.Node)\r\n    btnGetByGold: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    lb_price: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    btnGetByVideo: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    flag_using: cc.Node = null;\r\n\r\n\r\n    protected dataChanged():void {\r\n        if (!this.data) return;\r\n        let data = this.data as SkinShopItemData;\r\n        \r\n        if (data.bUnlock) {\r\n            this.btnGetByGold.active = false;\r\n            this.btnGetByVideo.active = false;\r\n            let usingId = userData.getData(localStorageKey.USING_SKIN_INDEX);\r\n            if (usingId == data.id) {//正在使用的一定是已解锁的\r\n                this.flag_using.active = true;\r\n            }\r\n            else {\r\n                this.flag_using.active = false;\r\n            }\r\n        }\r\n        else {\r\n            this.flag_using.active = false;\r\n            switch(data.costType) {\r\n                case 0:\r\n                    this.btnGetByGold.active = true;\r\n                    this.btnGetByVideo.active = false;\r\n                    let lbPrice = this.lb_price.getComponent(cc.Label);\r\n                    lbPrice.string = `${data.costNum}`;\r\n                    let own = userData.getData(localStorageKey.GOLD);\r\n                    this.btnGetByGold.getChildByName(\"grayMask\").active = own >= data.costNum ? false : true;\r\n                    break;\r\n                case 1:\r\n                    this.btnGetByGold.active = false;\r\n                    this.btnGetByVideo.active = true;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        if (this.lastData && this.lastData.resName == this.data.resName) {\r\n            //不用更新spine动画\r\n            return;\r\n        }\r\n        else {\r\n            let bedSprite = this.bed.getComponent(cc.Sprite);\r\n            let weaponIdx = userData.getData(localStorageKey.USING_WEAPON_IDX) + 1;\r\n            SpineManager.getInstance().loadSpine(this.model, \"spine/players/\"+this.data.resName + \"\" + weaponIdx, true, \"default\", \"daiji2\");\r\n            bedSprite.spriteFrame = new cc.SpriteFrame(\"texture/load/img_bed_2.png\");\r\n        }\r\n    }\r\n    /** */\r\n    protected updateSelected():void {\r\n        let bedSprite = this.bed.getComponent(cc.Sprite);\r\n        if (this.mSelected) {\r\n            //img_bed_3.png这个图片资源没有在prefab中引用，所有没有被加载过，要加载资源才能显示\r\n            cc.loader.loadRes(\"texture/load/img_bed_3\", cc.SpriteFrame, (err, spriteFrame) => {\r\n                bedSprite.spriteFrame = spriteFrame;\r\n            });\r\n        }\r\n        else {\r\n            bedSprite.spriteFrame = new cc.SpriteFrame(\"texture/load/img_bed_2.png\");\r\n        }\r\n    }\r\n    /**选中子项 */\r\n    private onItemSelected():void {\r\n        if (this.data.bUnlock) {//如果是选中的已解锁的子项，同时切换正在使用的皮肤数据\r\n            cc.find(\"Canvas\").emit(EventDefine.SHOP_ITEM_SELECTED_AND_CHANGE_USING_SKIN, this.itemIndex );\r\n        }\r\n        else {\r\n            cc.find(\"Canvas\").emit(EventDefine.SHOP_ITEM_SELECTED, this.itemIndex );\r\n        }\r\n    }\r\n\r\n    private onBtnGetByGold():void {\r\n        let data = this.data as SkinShopItemData;\r\n        let deviation = userData.getData(localStorageKey.GOLD) - data.costNum;\r\n        if (deviation >= 0) {\r\n            userData.setData(localStorageKey.GOLD, deviation);\r\n            cc.find(\"Canvas\").emit(EventDefine.UNLOCK_SKIN_BY_GOLD, this.itemIndex );\r\n        }\r\n        else {\r\n            Utils.showMessage(cc.find(\"Canvas\"), \"No Enough gold\");\r\n        }\r\n    }\r\n\r\n    private onBtnGetByVideo():void {\r\n        cc.find(\"Canvas\").emit(EventDefine.UNLOCK_SKIN_BY_AD, this.itemIndex);\r\n    }\r\n\r\n    restore() {\r\n        \r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}