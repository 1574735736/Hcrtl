{"version":3,"sources":["assets\\script\\gameScence\\TowerTile.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport PrefabsManager from \"../manager/PrefabsManager\";\r\nimport RoleBase, { RoleType } from \"./RoleBase\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TowerTile extends cc.Component {\r\n    private prefabsManager = PrefabsManager.getInstance();\r\n    private index: number = 0;\r\n    private monsterList: any = [];\r\n    private player: cc.Node = null;\r\n    private princess: cc.Node = null;\r\n    private lock = false;\r\n    private playerData = null;\r\n    private guidance = false;\r\n\r\n    private isPriences = false;\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n\r\n    //初始化塔信息\r\n    public initData(index: number, datas: any, weapon: sp.Skeleton) {\r\n        this.index = index;\r\n       \r\n        if (datas && datas.length > 0) {\r\n            let monsterCount = 0;\r\n            //怪物个数,用于调整怪物位置\r\n            for (let i = 0; i < datas.length; i++) {\r\n                let data = datas[i];\r\n                if (data.type == \"monster\" || data.type == \"item\" || data.type == \"princess\" || data.type == \"weapon\"){\r\n                    monsterCount++;\r\n                }\r\n            }\r\n            for (let i = 0; i < datas.length; i++) {\r\n                let data = datas[i];\r\n                if (data.prefab == null) {\r\n                    continue;\r\n                }\r\n                let tempNode = null;\r\n                if (data.type == 'player') {\r\n                    tempNode = cc.instantiate(this.prefabsManager.playerPrefabList[data.prefab]);\r\n                }\r\n                else if (data.type == \"weapon\") {\r\n                    tempNode = cc.instantiate(this.prefabsManager.weaponPreList[data.prefab]);\r\n                }\r\n                else {\r\n                    tempNode = cc.instantiate(this.prefabsManager.monsterPrefabList[data.prefab]);\r\n                }\r\n                tempNode.y += 150;\r\n                // this.node\r\n                let role = tempNode.getComponent(RoleBase);\r\n\r\n                role.init(data, weapon);\r\n\r\n                if( monsterCount>2){\r\n                    tempNode.position = cc.v3((i-1) * 110, tempNode.y, 0);\r\n                    // tempNode.setS = 0.8;\r\n                    if(tempNode.name.indexOf(\"Wizard\")!=-1 \r\n                    || tempNode.name.indexOf(\"Bow\")!=-1\r\n                    || tempNode.name.indexOf(\"Shield\")!=-1\r\n                    || tempNode.name.indexOf(\"Sword\")!=-1\r\n                    || tempNode.name.indexOf(\"Vampire\")!=-1){\r\n                        tempNode.scaleX = -0.6;\r\n                        tempNode.scaleY = 0.6;\r\n                    }\r\n                }else{\r\n                    tempNode.position = cc.v3(i * 130, tempNode.y, 0);\r\n                }\r\n               \r\n\r\n                if (data.type == 'player') {\r\n                    this.playerData = data;\r\n                    this.player = tempNode;\r\n                    tempNode.position = cc.v3(-50,10, 0); // tempNode.y\r\n                    this.node.addChild(tempNode, 1, \"player\");\r\n                } else if (data.type == 'monster') {\r\n                    this.node.addChild(tempNode);\r\n                    this.monsterList.push(tempNode);\r\n                } else if (data.type == 'item' || data.type == \"weapon\") {\r\n                    // tempNode.position = cc.v3(i * 80, tempNode.y, 0);\r\n                    this.node.addChild(tempNode, 1, \"item\");\r\n                } else if (data.type == 'lock') {\r\n                    this.lock = true;\r\n                    tempNode.position = cc.v3(0, tempNode.y, 0);\r\n                    this.node.addChild(tempNode, 1, \"lock\");\r\n                }\r\n                else if (data.type == 'princess') {\r\n\r\n                    //tempNode.position = cc.v3((i - 1) * 110, 0, 0);\r\n                    this.node.addChild(tempNode);\r\n                    this.princess = tempNode;\r\n                    this.isPriences = true;\r\n                }\r\n                else if (data.type == 'guidance') {\r\n                    this.guidance = true;\r\n                    tempNode.active = true;\r\n                    tempNode.scale = 1.75;\r\n                    tempNode.position = cc.v3(-20, 150, 0);\r\n                    this.node.addChild(tempNode, 1, \"guidance\");\r\n                }\r\n                if (data.scale) {\r\n                    role.SetScale(data.scale);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public unLock() {\r\n        let lock = this.node.getChildByName(\"lock\");\r\n        if (lock) {\r\n            lock.removeFromParent();\r\n            lock.destroy();\r\n            this.lock = false;\r\n        }\r\n    }\r\n\r\n    public unGuidance() {\r\n        let guidance = this.node.getChildByName(\"guidance\");\r\n        if (guidance) {\r\n            guidance.removeFromParent();\r\n            guidance.destroy();\r\n            this.guidance = false;\r\n        }\r\n    }\r\n\r\n    public addPlayer(player) {\r\n        this.player = player;\r\n        player.position = cc.v3(0, 0, 0);//(0, this.node.y + 80, 0);\r\n        this.node.addChild(player,1, \"player\");\r\n    }\r\n\r\n    public isLock() {\r\n        return this.lock;\r\n    }\r\n\r\n    public isGuidance() {\r\n        return this.guidance;\r\n    }\r\n\r\n    public getIndex() {\r\n        return this.index;\r\n    }\r\n\r\n    public getPlayer() {        \r\n        return this.player;\r\n    }\r\n\r\n    public getPrincess() {\r\n        return this.princess;\r\n    }\r\n\r\n    public getMonsters() {\r\n        return this.monsterList;\r\n    }\r\n\r\n    public getMonster() {\r\n        // let monster = this.monsterList.shift();\r\n        // if (monster) {\r\n        //     let monsterRole = monster.getComponent(RoleBase);\r\n        //     if (monsterRole.getShieldHp() > 0) {\r\n        //         this.monsterList.splice(0, 0, monster)\r\n        //     }\r\n        // }\r\n        let monster = null;\r\n        if(this.monsterList && this.monsterList.length>0){\r\n            monster = this.monsterList[0];\r\n        }\r\n        return monster;\r\n    }\r\n\r\n    public getMonsterItem() {\r\n        for (var i = this.node.children.length -1; i >= 0 ; i--) {\r\n            var base = this.node.children[i].getComponent(RoleBase);\r\n            if (!base) {\r\n                return null;\r\n            }\r\n            if (base.type == RoleType.MONSTER || base.type == RoleType.ITEM || base.type == RoleType.PRINCESS || base.type == RoleType.EGG) {\r\n                return this.node.children[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public removeMonster(){\r\n        if(this.monsterList && this.monsterList.length>0){\r\n           this.monsterList.shift();\r\n        }\r\n    }\r\n\r\n    // public pushMonster(monster){\r\n    //     this.monsterList.push(monster);\r\n    // }\r\n\r\n    public hasMonster() {\r\n        return this.monsterList.length > 0;\r\n    }\r\n\r\n    public hasItem() {\r\n        return this.node.getChildByName(\"item\") != null;\r\n    }\r\n\r\n    public getItem() {\r\n        return this.node.getChildByName(\"item\");\r\n    }\r\n\r\n\r\n    public isPlayer() {\r\n        return this.player != null;\r\n    }\r\n\r\n    public isPrincess() {\r\n        return this.princess != null;\r\n    }\r\n\r\n    public GetTilePos() {\r\n        return this.node.getPosition();\r\n    }\r\n\r\n    // update (dt) {}\r\n\r\n    public GetIsPriences() {\r\n        return this.isPriences;\r\n    }\r\n    public SetIsPriences(is: boolean) {\r\n        this.isPriences = is;\r\n    }\r\n}\r\n"]}