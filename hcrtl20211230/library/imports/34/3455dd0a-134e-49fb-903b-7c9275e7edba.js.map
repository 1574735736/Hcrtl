{"version":3,"sources":["assets\\script\\mainScene\\WeaponShop.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nconst { ccclass, property } = cc._decorator;\r\nimport { localStorageKey, userData } from \"../data/UserData\";\r\nimport EventDefine from \"../util/EventDefine\";\r\nimport SpineManager from \"../manager/SpineManager\";\r\nimport SkinShopItemData from \"../util/SkinShopItemData\";\r\nimport WeaponItemData from \"../util/WeaponItemData\";\r\nimport SdkManager from \"../util/SdkManager\";\r\nimport { FirebaseKey, FirebaseReport } from \"../util/FirebaseReport\";\r\nimport Utils from \"../util/Utils\";\r\nimport MainScene from \"../mainScene/MainScene\";\r\n\r\n\r\n@ccclass\r\nexport default class WeaponShop extends cc.Component {\r\n\r\n    private shop_num_gold: cc.Label = null\r\n\r\n    private showModelOfShop: sp.Skeleton;\r\n\r\n    private shopDatas: SkinShopItemData[] = null;\r\n    private weaponDatas: WeaponItemData[] = null;\r\n\r\n    private Item: cc.Node = null;\r\n    private content: cc.Node = null;\r\n    private pItems: cc.Node[] = [];\r\n\r\n    private selectPos: number = 0;\r\n\r\n    private curGold: number = 0;\r\n\r\n    \r\n    start () {\r\n\r\n        this.shop_num_gold = cc.find(\"bg_gold/num_gold\", this.node).getComponent(cc.Label);\r\n        this.shopDatas = userData.getData(localStorageKey.SHOP_DATAS);\r\n        this.weaponDatas = userData.getData(localStorageKey.WEAPON_DATAS);\r\n\r\n        var btn_return = cc.find(\"btn_home\", this.node);\r\n        btn_return.on(EventDefine.CLICK, this.OnClosePanel, this);\r\n        this.showModelOfShop = (cc.find(\"model_using/roleModel\", this.node)).getComponent(sp.Skeleton);\r\n        this.Item = cc.find(\"Item\", this.node);\r\n        this.content = cc.find(\"ScrollView/view/content\", this.node);\r\n        cc.find(\"Canvas\").on(EventDefine.GOLD_CHANGE, () => {\r\n            this.UndateGlodNum();\r\n        });\r\n\r\n        \r\n        this.UndateGlodNum();\r\n        this.updateItems();\r\n        this.updateShowModel();\r\n\r\n    }\r\n\r\n    private m_Listerer = null;\r\n    public Init(listerer): void{\r\n        this.m_Listerer = listerer;\r\n    }\r\n\r\n    UndateGlodNum() {\r\n        this.curGold = userData.getData(localStorageKey.GOLD);\r\n        this.shop_num_gold.string = this.curGold + \"\";\r\n    }\r\n\r\n    OnClosePanel() {\r\n        FirebaseReport.reportInformation(\"arms_ranbui\");\r\n        this.m_Listerer.showMainView();\r\n        this.node.destroy();\r\n    }\r\n\r\n    private updateShowModel(): void {\r\n        let usingIndex = userData.getData(localStorageKey.USING_SKIN_INDEX);            \r\n\r\n        let resName = this.shopDatas[usingIndex].resName;\r\n        let weaponIdx = this.selectPos + 1;\r\n        SpineManager.getInstance().loadSpine(this.showModelOfShop, \"spine/players/\" + resName + \"\" + weaponIdx, true, \"default\", \"daiji\");\r\n\r\n    }\r\n\r\n\r\n\r\n    /**�����б�����*/\r\n    private updateItems(): void {\r\n        let rowNum = 3;\r\n\r\n        var spaceX: number = 10;\r\n        var spaceY: number = 10;\r\n        var scaleSize: number = 0.8;\r\n        var width: number = this.Item.width * scaleSize;\r\n        var height: number = this.Item.height * scaleSize;\r\n        var countY: number = \r\n            rowNum * (height + spaceY) + spaceY;\r\n        this.content.height = countY;\r\n\r\n        for (let i = 0; i < this.weaponDatas.length; i++) {\r\n            let increaseX = width + spaceX;//Ϊ��\r\n            let initPosX = -(increaseX * 3 - 10) / 2 + width / 2;\r\n            let increaseY = -(height + spaceY);//Ϊ��\r\n            let initPosY = this.content.height / 2 - (spaceY + height / 2);\r\n            let item = cc.instantiate(this.Item);\r\n            this.content.addChild(item);\r\n            let rowIndex = Math.floor(i / 3);\r\n            let columnsIndex = i % 3;\r\n            let x = initPosX + columnsIndex * increaseX;\r\n            let y = initPosY + rowIndex * increaseY;\r\n            item.setPosition(x, y);\r\n            item.setScale(scaleSize, scaleSize);\r\n            item.active = true;\r\n            \r\n            this.pItems.push(item);\r\n\r\n            var text1 = cc.find(\"btn_Buy/txt_Price\", item).getComponent(cc.Label);\r\n            var text2 = cc.find(\"btn_None/txt_Price\", item).getComponent(cc.Label);\r\n\r\n            text1.string = String(this.weaponDatas[i].costNum);\r\n            text2.string = String(this.weaponDatas[i].costNum);\r\n\r\n            var use = item.getChildByName(\"btn_Use\");\r\n            var get = item.getChildByName(\"btn_Get\");\r\n            var buy = item.getChildByName(\"btn_Buy\");\r\n            var bg = item.getChildByName(\"btn_Bg\"); \r\n\r\n            var icon = item.getChildByName(\"img_weapon\").getComponent(cc.Sprite);\r\n            this.onSetIcon(icon,this.weaponDatas[i].resName);\r\n\r\n            use.on(EventDefine.CLICK, () => { this.OnClickUse(i); }, this);\r\n            get.on(EventDefine.CLICK, () => { this.OnClickAds(i); }, this);\r\n            buy.on(EventDefine.CLICK, () => { this.OnClickBuy(i); }, this);\r\n            bg.on(EventDefine.CLICK, () => { this.OnClickSelect(i); }, this);\r\n\r\n            \r\n        }\r\n\r\n        this. UpdateBtnStatus()\r\n        \r\n    }\r\n\r\n    private UpdateBtnStatus() {\r\n        var useWeapon = userData.getData(localStorageKey.USING_WEAPON_IDX);\r\n        this.selectPos = useWeapon;\r\n\r\n        for (var i = 0; i < this.pItems.length; i++) {\r\n\r\n            var item = this.pItems[i];\r\n\r\n            var use = item.getChildByName(\"btn_Use\");\r\n            var get = item.getChildByName(\"btn_Get\");\r\n            var buy = item.getChildByName(\"btn_Buy\");\r\n            var none = item.getChildByName(\"btn_None\");\r\n\r\n            use.active = false;\r\n            get.active = false;\r\n            buy.active = false;\r\n            none.active = false;\r\n\r\n            if (this.weaponDatas[i].bUnlock && useWeapon == i) {\r\n\r\n            }\r\n            else if (this.weaponDatas[i].bUnlock) {\r\n                use.active = true;\r\n            }\r\n            else if (this.weaponDatas[i].costType == 1) {\r\n                get.active = true;\r\n            }\r\n            else if (this.weaponDatas[i].costNum <= this.curGold) {\r\n                buy.active = true;\r\n            }\r\n            else {\r\n                none.active = true;\r\n            }\r\n\r\n            item.getChildByName(\"img_SelectBg\").active = i == useWeapon ? true : false;\r\n        }\r\n    }\r\n\r\n    private OnClickSelect(index: number) {\r\n        this.UpdateSelect(index);\r\n        if (this.weaponDatas[index].bUnlock) {\r\n            this.OnClickUse(index);\r\n        }\r\n    }\r\n\r\n    private OnClickUse(index: number) {\r\n        this.UpdateSelect(index);\r\n        userData.setData(localStorageKey.USING_WEAPON_IDX, this.selectPos);\r\n        this.UpdateBtnStatus();\r\n        \r\n    }\r\n\r\n    private OnClickAds(index: number) {\r\n        this.UpdateSelect(index);\r\n        SdkManager.GetInstance().JavaRewardedAds(\"arms_ad2\", () => {\r\n            this.weaponDatas[this.selectPos].bUnlock = true;\r\n            userData.setData(localStorageKey.WEAPON_DATAS, this.weaponDatas);\r\n            this.OnClickUse(index);\r\n        }, () => { this.noAdCallback(); })\r\n    }\r\n\r\n    private OnClickBuy(index: number) {\r\n        FirebaseReport.reportInformation(\"arms_goumai\");\r\n        this.UpdateSelect(index);\r\n        this.curGold = this.curGold - this.weaponDatas[this.selectPos].costNum;\r\n        userData.setData(localStorageKey.GOLD, this.curGold);\r\n        this.weaponDatas[this.selectPos].bUnlock = true;\r\n        userData.setData(localStorageKey.WEAPON_DATAS, this.weaponDatas);\r\n        this.OnClickUse(index);\r\n    }    \r\n\r\n    private UpdateSelect(index: number) {\r\n        this.pItems[this.selectPos].getChildByName(\"img_SelectBg\").active = false;\r\n        this.selectPos = index;\r\n        this.pItems[this.selectPos].getChildByName(\"img_SelectBg\").active = true;\r\n\r\n        this.updateShowModel();\r\n    }\r\n\r\n    private onSetIcon(spr: cc.Sprite, iconPath: string) {\r\n        var strPath: string = \"texture/game/weapon/\";\r\n        strPath = strPath + iconPath;\r\n        cc.loader.loadRes(strPath, cc.SpriteFrame, (err, sp) => {\r\n            spr.spriteFrame = sp as cc.SpriteFrame;\r\n        });\r\n    }\r\n\r\n    private noAdCallback(): void {\r\n        Utils.showMessage(this.node, \"Ad not ready\");\r\n    }\r\n    \r\n}\r\n"]}