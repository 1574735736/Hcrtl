{"version":3,"sources":["assets\\script\\mainScene\\MainScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { localStorageKey, userData } from \"../data/UserData\";\r\nimport SpineManager from \"../manager/SpineManager\";\r\nimport EventDefine from \"../util/EventDefine\";\r\nimport { FirebaseKey, FirebaseReport } from \"../util/FirebaseReport\";\r\nimport ListView from \"../util/ListView\";\r\nimport SkinShopItemData from \"../util/SkinShopItemData\";\r\nimport Utils from \"../util/Utils\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MainScene extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    public mainRoot: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    public SkinShopRoot: cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    public num_gold_main: cc.Label = null;\r\n\r\n    @property(sp.Skeleton)\r\n    public roleModel:sp.Skeleton = null;\r\n\r\n\r\n    private static _instance:MainScene = null;\r\n\r\n\r\n    private shop_num_gold:cc.Label;\r\n    \r\n    private listViewScript: ListView;\r\n\r\n    private shopDatas: SkinShopItemData[] = null;\r\n\r\n    private showModelOfShop:sp.Skeleton;\r\n    /**需要解锁的皮肤序号 */\r\n    private unlockIndex:number;\r\n\r\n\r\n    onLoad () {\r\n        MainScene._instance = this;\r\n\r\n        this.initListener();\r\n        this.showMainView();\r\n    }\r\n\r\n    /**初始化监听 */\r\n    private initListener():void {\r\n        cc.find(\"Canvas\").on(EventDefine.GOLD_CHANGE, () => {\r\n            let goldNum:number = userData.getData(localStorageKey.GOLD);\r\n            this.num_gold_main.string = goldNum + \"\";\r\n            if (this.shop_num_gold) {\r\n                this.shop_num_gold.string = goldNum + \"\";\r\n            }\r\n        });\r\n\r\n        cc.find(\"Canvas\").on(EventDefine.USING_SKIN_CHANGE, () => {\r\n\r\n        });\r\n    }\r\n\r\n\r\n    /**展示主界面 */\r\n    private showMainView():void {\r\n        this.num_gold_main.string = userData.getData(localStorageKey.GOLD);\r\n        this.mainRoot.active = true;\r\n        this.SkinShopRoot.active = false;\r\n\r\n        let usingIndex = userData.getData(localStorageKey.USING_SKIN_INDEX);\r\n        let skinDatas = userData.getData(localStorageKey.SHOP_DATAS) as SkinShopItemData[];\r\n\r\n        SpineManager.getInstance().loadSpine(this.roleModel, \"spine/player/\"+skinDatas[usingIndex].resName, true, \"default\", \"daiji3\");\r\n    }\r\n\r\n    private onBtnStart():void {\r\n        FirebaseReport.reportInformation(FirebaseKey.shouye_start);\r\n        cc.director.loadScene('GameScene');//进入游戏场景\r\n    }\r\n\r\n    private onBtnSkin():void {\r\n        FirebaseReport.reportInformation(FirebaseKey.shouye_skin);\r\n        this.showSkinShop();\r\n    }\r\n\r\n    private onBtnHome():void {\r\n        FirebaseReport.reportInformation(FirebaseKey.skin_ranbui);\r\n        this.showMainView();\r\n    }\r\n\r\n    /**展示皮肤商店 */\r\n    private showSkinShop():void {\r\n        this.mainRoot.active = false;\r\n        this.SkinShopRoot.active = true;\r\n\r\n        this.shop_num_gold = cc.find(\"bg_gold copy/num_gold\", this.SkinShopRoot).getComponent(cc.Label);\r\n        this.listViewScript = this.SkinShopRoot.getChildByName(\"skinListView\").getComponent(ListView);\r\n        this.showModelOfShop = (cc.find(\"model_using/roleModel\", this.SkinShopRoot)).getComponent(sp.Skeleton);\r\n\r\n        this.shop_num_gold.string = userData.getData(localStorageKey.GOLD);\r\n        \r\n        this.initShopList();\r\n        this.updateShowModel();\r\n\r\n        cc.find(\"Canvas\").on(EventDefine.SHOP_ITEM_SELECTED, (index) => {\r\n            this.onListItemSelected(index);\r\n        });\r\n        cc.find(\"Canvas\").on(EventDefine.SHOP_ITEM_SELECTED_AND_CHANGE_USING_SKIN, (index) => {\r\n            userData.setData(localStorageKey.USING_SKIN_INDEX, index);\r\n            this.onListItemSelected(index);\r\n        });\r\n        cc.find(\"Canvas\").on(EventDefine.UNLOCK_SKIN_BY_AD, (index) => {\r\n            this.unlockIndex = index;\r\n            this.unlockSkinByAd();\r\n        });\r\n        cc.find(\"Canvas\").on(EventDefine.UNLOCK_SKIN_BY_GOLD, (index) => {\r\n            this.unlockIndex = index;\r\n            FirebaseReport.reportInformation(FirebaseKey.skin_goumai);\r\n            this.unlockSkin();\r\n        });\r\n    }\r\n\r\n    /**更新上方的展示模型的显示*/\r\n    private updateShowModel(bShowUpgradeAnim:boolean = false):void {\r\n        let resName = this.shopDatas[this.listViewScript.selectedIndex].resName;\r\n        if (bShowUpgradeAnim) {\r\n            SpineManager.getInstance().loadSpine(this.showModelOfShop, \"spine/player/\"+resName, true, \"default\", \"daiji\", () => {\r\n                SpineManager.getInstance().playSpinAnimation(this.showModelOfShop, \"shengji\", false, () => {\r\n                    SpineManager.getInstance().playSpinAnimation(this.showModelOfShop, \"daiji\",true, null);\r\n                });\r\n            });\r\n        }\r\n        else {\r\n            SpineManager.getInstance().loadSpine(this.showModelOfShop, \"spine/player/\"+resName, true, \"default\", \"daiji\");\r\n        }\r\n    }\r\n\r\n    private initShopList():void {\r\n        let usingIndex = userData.getData(localStorageKey.USING_SKIN_INDEX);\r\n        this.shopDatas = userData.getData(localStorageKey.SHOP_DATAS);\r\n        this.listViewScript.selectedIndex = usingIndex;\r\n        this.listViewScript.replaceAll(this.shopDatas);\r\n        this.listViewScript.scrollToTop();\r\n    }\r\n\r\n    public updateShopList(): void {\r\n        this.listViewScript.replaceAll(this.shopDatas);\r\n    }\r\n\r\n    private onListItemSelected(selectedId:number):void {\r\n        this.listViewScript.selectedIndex = selectedId;\r\n        this.updateShowModel();\r\n        this.updateShopList();\r\n    }\r\n\r\n    /**是否获得了解锁皮肤的广告奖励 */\r\n    private bEarnedRewardOfSkinAd:boolean;\r\n\r\n    private unlockSkinByAd():void {\r\n        if (cc.sys.platform == cc.sys.ANDROID) {\r\n            FirebaseReport.reportInformation(FirebaseKey.skin_ad2);\r\n            jsb.reflection.callStaticMethod(\"org/cocos2dx/javascript/RewardedAdManager\", \"JsCall_showAdIfAvailable\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\",'cc[\"MainScene\"].JavaCall_unlockSkin()', 'cc[\"MainScene\"].JavaCall_noAdCallback()', \"skin_ad2\", 'cc[\"MainScene\"].JavaCall_closeAdCallback()');\r\n        }\r\n        else {\r\n            this.unlockSkin();\r\n        }\r\n    }\r\n\r\n    private unlockSkin():void{\r\n        let itemData = this.shopDatas[this.unlockIndex];\r\n        if (itemData) {\r\n            itemData.bUnlock = true;\r\n            userData.setData(localStorageKey.SHOP_DATAS, this.shopDatas);\r\n            userData.setData(localStorageKey.USING_SKIN_INDEX, this.unlockIndex);//同时设置为正在使用的皮肤\r\n            this.listViewScript.selectedIndex = this.unlockIndex;//同时选中新解锁的皮肤\r\n            this.updateShowModel(true);\r\n            this.updateShopList();\r\n        }\r\n    }\r\n\r\n    public static JavaCall_unlockSkin():void {\r\n        MainScene._instance.unlockSkin();\r\n    }\r\n\r\n\r\n    public static JavaCall_noAdCallback():void{\r\n        MainScene._instance.noAdCallback();\r\n    }\r\n\r\n    public static JavaCall_closeAdCallback():void {\r\n        MainScene._instance.closeAdCallback();\r\n    }\r\n\r\n    private noAdCallback():void{\r\n        Utils.showMessage(this.node, \"Ad not ready\");\r\n    }\r\n\r\n    private closeAdCallback():void {\r\n        // to do\r\n    }\r\n\r\n}\r\n"]}