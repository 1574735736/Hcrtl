{"version":3,"sources":["assets\\script\\manager\\SpineManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport BaseInstanceClass from \"./BaseInstanceClass\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SpineManager extends BaseInstanceClass {\r\n /**\r\n     * 播放spin动画\r\n     * @param animationName 动画名称\r\n     * @param completeCallback 播放回调\r\n     * @param isLoop 是否循环\r\n     */\r\n    public playSpinAnimation(spinSkeleton: sp.Skeleton, animationName: string, isLoop: boolean, completeCallback: any, self: any = null, timeScale: number = 1) {\r\n\r\n        if (spinSkeleton == null) {\r\n            return;\r\n        }\r\n    // console.log('播放动画', animationName, 'spinSkeleton', spinSkeleton, isLoop)\r\n    spinSkeleton.setStartListener(null);\r\n    spinSkeleton.loop = isLoop;\r\n    spinSkeleton.timeScale = timeScale;\r\n    spinSkeleton.animation = animationName;\r\n    // spinSkeleton.setAnimation(0,animationName,isLoop);\r\n       \r\n      spinSkeleton.setCompleteListener(completeCallback);\r\n    // (completeCallback) ? : spinSkeleton.setCompleteListener(null);\r\n}\r\n\r\n    public loadSpine(spinSkeleton: sp.Skeleton, path: string, isLoop: boolean, skinName: string, animationName: string, completeCallback: Function = null) {\r\n\r\n        if (spinSkeleton == null) {\r\n            return;\r\n        }\r\n\r\n    cc.loader.loadRes(path, sp.SkeletonData, (err, spData) => {      \r\n\r\n        if (err) {\r\n            console.log(\"LoadSpin \", err)\r\n            return\r\n        }\r\n        spinSkeleton.skeletonData = spData;\r\n        spinSkeleton.defaultSkin = skinName;\r\n        spinSkeleton.setSkin(skinName);\r\n        spinSkeleton.loop = isLoop;\r\n        spinSkeleton.animation = animationName;\r\n        console.log('LoadSpin:****skinName', skinName)\r\n        if (completeCallback != null) {\r\n            completeCallback();\r\n        }\r\n        // spinSkeleton.setSkin(skinName);\r\n    })\r\n}\r\n\r\n    public loadSkinSpine(spinSkeleton: sp.Skeleton, weapon: sp.Skeleton, isLoop: boolean, skinIdx: number, weaponIdx: number, animationName: string, completeCallback: Function = null) {\r\n\r\n        if (spinSkeleton == null) {\r\n            return;\r\n        }\r\n\r\n        let path = skinIdx > 1 ? \"spine/play/pifu\" : \"spine/play/zhu1\";\r\n        cc.loader.loadRes(path, sp.SkeletonData, (err, spData) => {\r\n            if (err) {\r\n                console.log(\"LoadSpin \", err)\r\n                return\r\n            }\r\n            spinSkeleton.skeletonData = spData;\r\n            spinSkeleton.loop = isLoop;\r\n            spinSkeleton.animation = animationName;\r\n            if (completeCallback != null) {\r\n                completeCallback();\r\n            }\r\n\r\n            this.changSpinSkin(spinSkeleton, weapon, skinIdx, weaponIdx);\r\n           \r\n        })\r\n    }\r\n\r\n\r\n    public changSpinSkin(spSkin: sp.Skeleton, weapon: sp.Skeleton, skinIdx: number, weaponIdx: number) {\r\n\r\n        if (spSkin == null) {\r\n            return;\r\n        }\r\n\r\n        let sIdx = skinIdx - 1;\r\n        let sName = sIdx < 1 ? \"default\" : \"p\" + sIdx;\r\n\r\n        spSkin.defaultSkin = sName;\r\n\r\n        spSkin.setSkin(sName);\r\n\r\n        let slot1 = spSkin.findSlot(\"wq\");\r\n        let slot1_2 = spSkin.findSlot(\"wq2\");\r\n        let slot1_3 = spSkin.findSlot(\"wq3\");\r\n        let slot1_4 = spSkin.findSlot(\"wq4\");\r\n        let slot1_5 = spSkin.findSlot(\"wq5\");\r\n\r\n        if (!slot1) {\r\n            console.log(\"slot1   is   null !!!\");\r\n        }\r\n\r\n        if (!slot1_2) {\r\n            console.log(\"slot1_2   is   null !!!\");\r\n        }\r\n        if (!slot1_3) {\r\n            console.log(\"slot1_3   is   null !!!\");\r\n        }\r\n        if (!slot1_4) {\r\n            console.log(\"slot1_4   is   null !!!\");\r\n        }\r\n        if (!slot1_5) {\r\n            console.log(\"slot1_5   is   null !!!\");\r\n        }\r\n\r\n        let wName = \"\";\r\n        if (weaponIdx > 1) {\r\n            wName = \"wq\" + weaponIdx;\r\n        }\r\n        else {\r\n            if (sIdx <= 0) {\r\n                wName = \"wq1\";\r\n            }\r\n            else {\r\n                wName = \"ypwq\" + (sIdx);\r\n            }           \r\n        }\r\n      \r\n        let slot2 = weapon.findSlot(wName);\r\n       \r\n        let attachment = slot2.getAttachment();\r\n        slot1.setAttachment(attachment);\r\n        if (slot1_2) {\r\n            slot1_2.setAttachment(attachment);\r\n        }\r\n        if (slot1_3) {\r\n            slot1_3.setAttachment(attachment);\r\n        }\r\n        if (slot1_4) {\r\n            slot1_4.setAttachment(attachment);\r\n        }\r\n        if (slot1_5) {\r\n            slot1_5.setAttachment(attachment);\r\n        }\r\n    }\r\n\r\npublic getAnimationName(spinSkeleton: sp.Skeleton): string {\r\n    return spinSkeleton.animation;\r\n}\r\n}\r\n"]}